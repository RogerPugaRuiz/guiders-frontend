<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Guiders</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script src="https://animatedicons.co/scripts/embed-animated-icons.js"></script>
  <!-- Estilos para prevenir el destello del tema -->
  <style>
    /* Esta clase oculta momentáneamente el contenido durante la inicialización del tema */
    .theme-initializing {
      visibility: hidden;
    }
    /* Toda la página tendrá un fondo negro durante la carga para evitar el destello blanco */
    html {
      background-color: #0d1117; /* Color de fondo oscuro como fallback */
    }
    html[data-theme="light"] {
      background-color: #f6f8fa; /* Actualizado para tema claro */
    }
    html[data-theme="dark"] {
      background-color: #0d1117; /* Actualizado para tema oscuro */
    }
  </style>
  <!-- Script para prevenir el destello inicial del tema (optimizado para SSR) -->
  <!-- 
    Nota: Este script utiliza localStorage directamente en lugar de StorageService por dos razones:
    1. Necesita ejecutarse antes del bootstrap de Angular para prevenir el destello visual
    2. StorageService es una dependencia inyectable de Angular no disponible en este punto
    Este es un caso de uso legítimo para acceso directo a localStorage con las comprobaciones adecuadas
  -->
  <script>
    (function() {
      // Solo ejecutar en el cliente, no durante SSR
      if (typeof window !== 'undefined' && typeof document !== 'undefined') {
        try {
          // Aplicar clase CSS que oculta el contenido hasta que se defina el tema
          document.documentElement.classList.add('theme-initializing');
          
          // Verificar el tema guardado en localStorage
          var savedTheme = localStorage.getItem('theme');
          
          if (savedTheme) {
            // Aplicar tema guardado inmediatamente
            document.documentElement.setAttribute('data-theme', savedTheme);
          } else {
            // Detectar preferencia del sistema
            var prefersDarkMode = window.matchMedia && 
              window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            // Aplicar tema según preferencia del sistema
            var theme = prefersDarkMode ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            
            // También guardamos en localStorage para mantener consistencia
            try {
              localStorage.setItem('theme', theme);
            } catch (e) {
              // Ignorar errores de localStorage (navegación privada, etc.)
            }
          }
          
          // Aplicar color primario personalizado si existe
          var savedColor = localStorage.getItem('primaryColor');
          if (savedColor) {
            document.documentElement.style.setProperty('--color-primary', savedColor);
            
            // Convertir hex a rgb para la variable --color-primary-rgb
            var r = parseInt(savedColor.slice(1, 3), 16);
            var g = parseInt(savedColor.slice(3, 5), 16);
            var b = parseInt(savedColor.slice(5, 7), 16);
            
            document.documentElement.style.setProperty('--color-primary-rgb', r + ', ' + g + ', ' + b);
          }
        } catch (e) {
          // Manejo de errores
          console.warn('Error en la inicialización del tema:', e);
        }
      }
    })();
  </script>
</head>
<body>
  <app-root></app-root>
</body>
</html>
